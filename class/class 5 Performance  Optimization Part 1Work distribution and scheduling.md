# class 5 Performance  Optimization Part 1:Work distribution and scheduling

[toc]

平衡的工作负载、减少通信、减少额外工作

## 1 工作负载

1.静态分配：需要先进行一些计算，确定任务实际分配

2.半静态分配：短时间内的工作可预测

3.动态分配：工作队列，不同的核心从队列中取得任务

一次取得多个任务->减少时间浪费，负载均衡

小任务，细粒度->容易负载均衡

大任务->容易等待

大任务后面才出现怎么办？

分布式队列集合->核心有独立的队列，快的可以从其他队列偷任务



## 2 fork-join 并行

cilk_spawn->fork  创建新的控制线程

cilk_sync->join 等待所有线程汇合（函数结尾隐式调用）



进程池



先运行延续：初始时所有的任务都进入队列，其他线程可以偷孩子->广搜

先运行孩子：每次加入一个任务来到队列，其他线程偷延续->深搜

优劣？

需要队列存储空间



实现同步：无偷、延迟加入（跟踪偷）、贪婪策略（互偷）